
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="nl">
  <head>
    <meta charset="utf-8" />
    <title>NodeRed opdrachten &#8212; iot-0  documentatie</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/accessibility.css?v=DB047029" />
    <link rel="stylesheet" type="text/css" href="../_static/dragndrop.css?v=1FF7F927" />
    <link rel="stylesheet" type="text/css" href="../_static/poll.css?v=E220AC33" />
    <link rel="stylesheet" type="text/css" href="../_static/parsons.css?v=2F3E13EE" />
    <link rel="stylesheet" type="text/css" href="../_static/js_lib/prettify.css?v=2A364B6B" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/runestonebase.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/mchoice.js?v=7B685250"></script>
    <script type="text/javascript" src="../_static/timedmc.js?v=B010A457"></script>
    <script type="text/javascript" src="../_static/timed.js?v=FD1C5153"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/CLDRPluralRuleParser.js?v=599B42B0"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/jquery.i18n.js?v=88A1430F"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/jquery.i18n.messagestore.js?v=AE15A4A1"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/jquery.i18n.fallbacks.js?v=8ABDFE7F"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/jquery.i18n.language.js?v=747279FF"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/jquery.i18n.parser.js?v=7B020E13"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/jquery.i18n.emitter.js?v=660E85C3"></script>
    <script type="text/javascript" src="../_static/jquery_i18n/jquery.i18n.emitter.bidi.js?v=54B21948"></script>
    <script type="text/javascript" src="../_static/mchoice-i18n.en.js?v=354E6CD"></script>
    <script type="text/javascript" src="../_static/shortanswer.js?v=8FCEE330"></script>
    <script type="text/javascript" src="../_static/timed_shortanswer.js?v=B3A117D7"></script>
    <script type="text/javascript" src="../_static/dragndrop.js?v=86D99604"></script>
    <script type="text/javascript" src="../_static/timeddnd.js?v=378F237E"></script>
    <script type="text/javascript" src="../_static/dragndrop-i18n.en.js?v=40C28531"></script>
    <script type="text/javascript" src="../_static/poll.js?v=45F04365"></script>
    <script type="text/javascript" src="../_static/js_lib/prettify.js?v=CA7E8928"></script>
    <script type="text/javascript" src="../_static/js_lib/hammer.min.js?v=73056367"></script>
    <script type="text/javascript" src="../_static/parsons.js?v=CE79120E"></script>
    <script type="text/javascript" src="../_static/timedparsons.js?v=2EEA9E5A"></script>
    <script type="text/javascript" src="../_static/parsons-i18n.en.js?v=A9C11155"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Zoeken" href="../search.html" />
    <link rel="next" title="Toetsvragen" href="toetsvragen.html" />
    <link rel="prev" title="Inleiding NodeRed" href="nodered-inleiding.html" />

<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = '' ? '' : 'http://127.0.0.1:8000';
/*
  eBookConfig.app = eBookConfig.host+'/';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = '';
  eBookConfig.logLevel = ;
  eBookConfig.loginRequired = ;
  eBookConfig.build_info = "";
  eBookConfig.isLoggedIn = false;
  eBookConfig.useRunestoneServices = ;
  eBookConfig.python3 = ;
  eBookConfig.basecourse = '';
  eBookConfig.runestone_version = '';
*/
</script>
<script type="application/json" class="js-hypothesis-config">
{
"showHighlights": false
}
</script>
<script async src="https://hypothes.is/embed.js"></script>

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">iot-0</a></h1>








<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../voorwoord.html">Voorwoord</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../inleiding.html">IoT-toepassingen</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="geschiedenis.html">Geschiedenis en ontwikkeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="voorbeelden.html">Voorbeelden</a></li>
<li class="toctree-l2"><a class="reference internal" href="meer-toepassingen.html">Meer toepassingen</a></li>
<li class="toctree-l2"><a class="reference internal" href="iot-eisen.html">Eisen aan de communicatie</a></li>
<li class="toctree-l2"><a class="reference internal" href="overzicht.html">Overzicht</a></li>
<li class="toctree-l2"><a class="reference internal" href="gevolgen.html">Gevolgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="opdrachten.html">Opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="nodered-inleiding.html">Inleiding NodeRed</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">NodeRed opdrachten</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#eerste-flow">1. Eerste flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verbinden-met-een-iot-knoop-via-mqtt">2. Verbinden met een IoT-knoop via MQTT</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mqtt-input">2.1 MQTT input</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mqtt-output">2.2 MQTT output</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#automatiseren">3. Automatiseren</a></li>
<li class="toctree-l3"><a class="reference internal" href="#koppelen-van-iot-apparaten">4. Koppelen van IoT-apparaten</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#opdracht-4-1-besturen-van-je-eigen-iot-knoop">Opdracht 4.1 Besturen van je eigen IoT-knoop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#opdracht-4-2-besturen-van-een-andere-iot-knoop">Opdracht 4.2 Besturen van een andere IoT-knoop</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="toetsvragen.html">Toetsvragen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bouwstenen.html">Bouwstenen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webserver.html">Webserver-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wifi.html">WiFi-MQTT-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rfm69.html">RFM69-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lora.html">LoRa-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configureren.html">Configureren</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ten-geleide.html">Voor de docent</a></li>
</ul>
<p class="caption"><span class="caption-text">Andere modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/com-0/">Com-0</a></li>
<li class="toctree-l1"><a class="reference external" href="https://infvo.github.io/iot-1/">IoT-1</a></li>
</ul>


  <p class="topless"><a href="nodered-inleiding.html"
                        title="vorig hoofdstuk">Vorige</a></p>
  <p class="topless"><a href="toetsvragen.html"
                        title="volgend hoofdstuk">Volgende</a></p>
<div id="searchbox" style="display: none" role="search">

    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Zoek" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="nodered-opdrachten">
<h1>NodeRed opdrachten<a class="headerlink" href="#nodered-opdrachten" title="Permalink naar deze titel">¶</a></h1>
<p>Lees eerst de inleiding voor NodeRed.</p>
<div class="section" id="eerste-flow">
<h2>1. Eerste flow<a class="headerlink" href="#eerste-flow" title="Permalink naar deze titel">¶</a></h2>
<p>Met deze eerste flow kun je zien of alles werkt:</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/Nodered-flow11.png"><img alt="../_images/Nodered-flow11.png" src="../_images/Nodered-flow11.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">NodeRed: eerste flow</span><a class="headerlink" href="#id1" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p>Hiervoor gebruik je de volgende nodes:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 31%" />
<col style="width: 37%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>figuur</strong></p></td>
<td><p><strong>naam</strong></p></td>
<td><p><strong>soort node</strong></p></td>
</tr>
<tr class="row-even"><td><p><img alt="inject-node" src="../_images/inject-node1.png" /></p></td>
<td><p>inject-node</p></td>
<td><p>input</p></td>
</tr>
<tr class="row-odd"><td><p><img alt="debug-node" src="../_images/debug-node1.png" /></p></td>
<td><p>debug-node</p></td>
<td><p>output</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Opdracht 1.1</p>
<p>Voer de onderstaande opdrachten uit in een lege (flow)tab in NodeRed.</p>
<ul class="simple">
<li><p>sleep een inject-node vanuit de lijst met nodes links naar het lege vlak in het midden</p></li>
<li><p>plaats op dezelfde manier een debug-node;</p></li>
<li><p>verbind de output (rechts) van de inject-node met de input (links) van de debug-node;</p></li>
<li><p>activeer deze flow (rechts boven: <strong>Deploy</strong>);</p></li>
<li><p>selecteer de debug-tab (rechts);</p></li>
<li><p>test deze flow, door op het knopje links op de input-node (“timestamp”) te klikken.</p></li>
</ul>
<p>Als het goed is, krijg je in het debug-venster rechts nu de output van deze flow te zien.
Elke keer als je op de input-node klikt, genereert deze een timestamp-event.</p>
<p class="rubric">Opdracht 1.2</p>
<p>Voor onderstaande opdrachten uit; test de uitwerking (na “Deploy”) via de debug-tab.</p>
<ul class="simple">
<li><dl class="simple">
<dt>verander de configuratie van de inject-knoop: zorg ervoor dat deze elke 10 seconden een timestamp oplevert.</dt><dd><ul>
<li><p>double-click op een knoop geeft het configuratie-venster;</p></li>
<li><p>bewaar de nieuwe configuratie via de “Done”-knop.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>verander de configuratie van de inject-knoop: zorg ervoor dat deze een tekst levert als inhoud van het bericht (payload).</p></li>
<li><p>verbind meerdere inject-knopen met herhalende berichten met dezelfde debug-knoop.</p></li>
</ul>
<p><em>Tips</em>:</p>
<ul class="simple">
<li><p>je kunt in het debug-venster aangeven dat je alleen de “current flow” wilt zien;</p></li>
<li><p>je kunt het debug-venster leeg maken via het vuilnisbakje (rechts boven).</p></li>
</ul>
</div>
<div class="section" id="verbinden-met-een-iot-knoop-via-mqtt">
<h2>2. Verbinden met een IoT-knoop via MQTT<a class="headerlink" href="#verbinden-met-een-iot-knoop-via-mqtt" title="Permalink naar deze titel">¶</a></h2>
<p>Voor de communicatie tussen NodeRed en de IoT-knopen gebruiken we (meestal) het MQTT protocol.
In een later hoofdstuk werken we dat verder uit.
Het gebruik van MQTT-nodes in NodeRed is erg eenvoudig;
het lastigste is het configureren hiervan.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 32%" />
<col style="width: 32%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>figuur</strong></p></td>
<td><p><strong>naam</strong></p></td>
<td><p><strong>soort node</strong></p></td>
</tr>
<tr class="row-even"><td><p><img alt="mqtt-input-node" src="../_images/nodered-mqtt-input-node.png" /></p></td>
<td><p>mqtt-input-node</p></td>
<td><p>input</p></td>
</tr>
<tr class="row-odd"><td><p><img alt="mqtt-output-node" src="../_images/nodered-mqtt-output-node.png" /></p></td>
<td><p>mqtt-output-node</p></td>
<td><p>output</p></td>
</tr>
<tr class="row-even"><td><p><img alt="mqtt-broker-node" src="../_images/nodered-mqtt-broker-node.png" /></p></td>
<td><p>mqtt-broker-node</p></td>
<td><p>configuratie</p></td>
</tr>
</tbody>
</table>
<p>In de volgende opdrachten maak je de onderstaande flow om het gebruik van mqtt te testen.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/nodered-mqtt-0-flow.png"><img alt="../_images/nodered-mqtt-0-flow.png" src="../_images/nodered-mqtt-0-flow.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">MQTT input- en output-test</span><a class="headerlink" href="#id2" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<div class="section" id="mqtt-input">
<h3>2.1 MQTT input<a class="headerlink" href="#mqtt-input" title="Permalink naar deze titel">¶</a></h3>
<p>Als eerste proberen we de sensor-gegevens van een IoT-knoop te ontvangen in NodeRed.
De waarden van deze sensoren geven we eerst weer in het debug-venster;
later kunnen we deze gebruiken in een besturing of een dashboard.</p>
<ol class="arabic simple">
<li><p>Sleep een mqtt-input-node naar het flow-venster;</p></li>
<li><p>Configureer deze (door double-click):</p></li>
</ol>
<blockquote>
<div><ol class="arabic simple">
<li><p>Bij <cite>Server</cite> vul je de gegevens van de broker in.
Zie de schermafbeeldingen verderop.
Selecteer een eerder ingevulde broker of maak (via het potlood) een nieuwe broker aan.
Voorbeeld: onder tab Connection: <cite>Server:</cite> <cite>infvopedia.nl</cite> <cite>Port:</cite> <cite>1883</cite>
Onder de tab Security vul je de username/password-combinatie in.</p></li>
<li><p>Bij <cite>Topic</cite> vul je het sensor-topic van je IoT-knoop in,
bijvoorbeeld: <cite>node/xxxx/sensors</cite>,
met in plaats van <cite>xxxx</cite> de identificatie van je eigen knoop.</p></li>
<li><p>Bewaar de configuratie (Save).</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Sleep een debug-node naar het flow-venster en
verbind de output van de mqtt-node met de input van de debug-node.</p></li>
<li><p>Activeer de flow (“Deploy”)</p></li>
</ol>
<p>Als het goed is zie je in het debug-venster nu de berichten van je IoT-knoop verschijnen.
Je moet misschien even wachten; je kunt ook één de knoppen op de IoT-knoop proberen.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="../_images/nodered-mqtt-conf-0.png"><img alt="../_images/nodered-mqtt-conf-0.png" src="../_images/nodered-mqtt-conf-0.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text">MQTT broker configuration (1)</span><a class="headerlink" href="#id3" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="../_images/nodered-mqtt-conf-1.png"><img alt="../_images/nodered-mqtt-conf-1.png" src="../_images/nodered-mqtt-conf-1.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text">MQTT broker configuration (2)</span><a class="headerlink" href="#id4" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="../_images/nodered-mqtt-conf-2.png"><img alt="../_images/nodered-mqtt-conf-2.png" src="../_images/nodered-mqtt-conf-2.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text">MQTT broker configuration (3)</span><a class="headerlink" href="#id5" title="Permallink naar deze afbeelding">¶</a></p>
</div>
</div>
<div class="section" id="mqtt-output">
<h3>2.2 MQTT output<a class="headerlink" href="#mqtt-output" title="Permalink naar deze titel">¶</a></h3>
<div class="figure align-center" id="id6">
<a class="reference internal image-reference" href="../_images/nodered-mqtt-0-flow.png"><img alt="../_images/nodered-mqtt-0-flow.png" src="../_images/nodered-mqtt-0-flow.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">MQTT input- en output-test</span><a class="headerlink" href="#id6" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p>Op eenzelfde manier kunnen we via een inject-node berichten sturen naar een IoT-knoop.</p>
<ol class="arabic simple">
<li><p>Sleep een mqtt-output-node naar het flow-venster;</p></li>
<li><p>Configureer deze (door double-click):</p></li>
</ol>
<blockquote>
<div><ol class="arabic simple">
<li><p>Selecteer bij <cite>Server</cite> de broker die je hierboven geconfigureerd hebt.</p></li>
<li><p>Vul bij Topic in: <cite>node/xxxx/actuators</cite>,
met in plaats van <cite>xxxx</cite> de identificatie van je eigen knoop.</p></li>
<li><p>Bewaar de configuratie.</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Sleep een template-node (met “{” als symbool) naar het flow-venster en
verbind de output van de template-node met de input van de mqtt-node.
Configureer deze template-node: <cite>Name:</cite> <code class="docutils literal notranslate"><span class="pre">led0-on</span></code>, <cite>Format:</cite> <code class="docutils literal notranslate"><span class="pre">Plain</span> <span class="pre">text</span></code>,
en <cite>template</cite>: <code class="docutils literal notranslate"><span class="pre">{&quot;0&quot;:{&quot;dOut&quot;:1}}</span></code>. (Zie de figuur verderop.)</p></li>
<li><p>Sleep een inject-node naar het flow-venster en
verbind deze met de template-node <em>led0-on</em>.</p></li>
<li><p>Sleep een template-node naar het flow-venster en
verbind de output van de template-node met de input van de mqtt-node.
Configureer deze template-node: <cite>Name:</cite> <code class="docutils literal notranslate"><span class="pre">led0-off</span></code>, <cite>Format:</cite> <code class="docutils literal notranslate"><span class="pre">Plain</span> <span class="pre">text</span></code>,
en <cite>template</cite>: <code class="docutils literal notranslate"><span class="pre">{&quot;0&quot;:{&quot;dOut&quot;:0}}</span></code>.</p></li>
<li><p>Sleep een inject-node naar het flow-venster en
verbind deze met de template-node <code class="docutils literal notranslate"><span class="pre">led0-off</span></code>.</p></li>
<li><p>Activeer de flow (“Deploy”).</p></li>
</ol>
<p>Met de beide inject-nodes kun je (als alles goed gaat) nu de (linker) led van de IoT-knoop
in- en uitschakelen.</p>
<p><em>Opmerking</em>: als je de flow activeert, zie je bij de mqtt-nodes een gekleurd bolletje dat de toestand van de verbinding aangeeft.
Als de mqtt-knoop verbinding heeft met de mqtt-broker (server) is dit bolletje groen.</p>
<div class="figure align-center" id="id7">
<a class="reference internal image-reference" href="../_images/nodered-template-conf-0.png"><img alt="../_images/nodered-template-conf-0.png" src="../_images/nodered-template-conf-0.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text">Template node configuration (“led0-on”)</span><a class="headerlink" href="#id7" title="Permallink naar deze afbeelding">¶</a></p>
</div>
</div>
</div>
<div class="section" id="automatiseren">
<h2>3. Automatiseren<a class="headerlink" href="#automatiseren" title="Permalink naar deze titel">¶</a></h2>
<p>Via NodeRed kun je allerlei protocollen en toepassingen koppelen.
Je kunt ook allerlei zaken automatiseren, bijvoorbeeld een lamp inschakelen als je thuiskomt.</p>
<p>Een eenvoudige automatisering is het laten knipperen van LED-0 op de IoT-knoop.</p>
<p>Maak een NodeRed-flow waarmee je LED-0 van een (gesimuleerde) IoT-knoop laat knipperen.
Begin met de eenvoudige flow van Opdracht 1, en breid deze later uit met een MQTT-output-node.
Vergeet niet aan het eind van elke opdracht de flow te activeren (“Deploy”);
controleer bij elke stap of het werkt.</p>
<p class="rubric">Opdracht 3.1 - knipperende led(1)</p>
<p>In de eerste stap maak je een flow die elke seconde een bericht genereert,
afwisselend “aan” en “uit”.
Hiervoor gebruik je dezelfde flow die je in de vorige opdracht (2.2) gemaakt hebt.
Je programmeert alleen de inject-nodes anders.</p>
<ol class="arabic simple">
<li><p>Configureer de bovenste inject-node (voor “led0-on”):
deze moet elke 2 seconden een bericht sturen (“repeat: interval, every 2 seconds”),
waarmee de led ingeschakeld wordt.
Zie de figuur verderop.</p></li>
<li><p>Configureer de onderste inject-node (voor “led0-off”):
deze moet na een vertraging van 1 seconde (“inject once after 1 sec”),
elke 2 seconden een bericht sturen (“repeat: interval, every 2 seconds”).</p></li>
<li><p>Activeer de flow (“Deploy”).</p></li>
</ol>
<p>Als het goed is knippert de led nu 1 seconde aan, 1 seconde uit.</p>
<div class="figure align-center" id="id8">
<a class="reference internal image-reference" href="../_images/nodered-inject-conf-0.png"><img alt="../_images/nodered-inject-conf-0.png" src="../_images/nodered-inject-conf-0.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text">Inject node configuration: elke 2 seconden een bericht</span><a class="headerlink" href="#id8" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p class="rubric">Opdracht 3.2 - knipperende led(2)</p>
<p>Uiteindelijk willen we een led laten knipperen op basis van een enkel binnenkomend bericht
van een enkele node.
We beginnen daarom met één enkele niet-repeterende inject-node.
We gebruiken daarvoor een tweetal delay-nodes die we in een lus doorverbinden.
Zo’n delay node stuurt een binnengekomen bericht na een bepaalde vertraging door.</p>
<p>We beginnen met de flow als in de vorige opdracht.
Zorg ervoor dat de eerste inject-node niet herhaalt.
Verwijder de tweede inject-node.</p>
<ol class="arabic simple">
<li><p>Sleep een delay-node naar het flow-gedeelte, en configureer deze voor een vertraging van 1 sec.
Verbind de output van de bovenste inject-node met de input van deze delay-node.
Verbind deze input ook met de template-node <em>led0-on</em>.</p></li>
<li><p>Sleep een delay-node naar het flow-gedeelte, en configureer deze voor een vertraging van 1 sec.
Verbind de output van de eerste delay-node met de input van de tweede delay-node.
Verbind deze input ook met de template-node <em>led0-off</em>.
Verbind de output van de tweede delay-node met de input van de eerste delay-node.</p></li>
<li><p>Activeer de schakeling</p></li>
</ol>
<p>Als het goed is, begint de LED te knipperen als je de inject-node aanklikt.
(Ga na hoe deze schakeling werkt.)</p>
<p><em>Opmerking</em>: de techniek van het maken van een “oscillator” door meerdere vertragende componenten
in een lus te verbinden gebruik je ook in de elektronica (“ring oscillator”).</p>
<div class="figure align-center" id="id9">
<a class="reference internal image-reference" href="../_images/nodered-2-delay-flow-0.png"><img alt="../_images/nodered-2-delay-flow-0.png" src="../_images/nodered-2-delay-flow-0.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Knipperende led met delays(1)</span><a class="headerlink" href="#id9" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p class="rubric">Opdracht 3.3 - knipperende led(3)</p>
<p>De bovenstaande schakeling heeft één nadeel: deze blijft doorgaan.
We willen het aantal keren dat de led knippert beperken, bijvoorbeeld tot maximaal 5 keer.
Hiervoor gebruiken we een functie die steeds 5 berichten doorlaat en dan 1 niet.
Deze functie-node plaatsen we voor de eerste delay, zie de onderstaande flow:</p>
<div class="figure align-center" id="id10">
<a class="reference internal image-reference" href="../_images/nodered-2-delay-flow-1.png"><img alt="../_images/nodered-2-delay-flow-1.png" src="../_images/nodered-2-delay-flow-1.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Knipperende led met delays(1)</span><a class="headerlink" href="#id10" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<ol class="arabic simple">
<li><p>maak bovenstaande flow.</p></li>
<li><p>configureer de function-node “limit-5-messages” op de volgende manier:</p></li>
</ol>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span>
<span class="nx">count</span> <span class="o">=</span> <span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">context</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="nx">count</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">context</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">msg</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Een korte uitleg bij deze functie (voor als je het naadje van de kous wilt weten):</p>
<ul class="simple">
<li><p>we gebruiken een <em>context variabele</em> <code class="docutils literal notranslate"><span class="pre">count</span></code>; deze houdt het aantal aanroepen c.q. ontvangen berichten bij.</p></li>
<li><p>een verdere uitleg van context variabelen in NodeRed vind je op: <a class="reference external" href="https://nodered.org/docs/user-guide/context">https://nodered.org/docs/user-guide/context</a>
en <a class="reference external" href="https://nodered.org/docs/user-guide/writing-functions">https://nodered.org/docs/user-guide/writing-functions</a></p></li>
<li><p>als dit aantal groter is dan 5, zet dan de teller weer op 0, en geef <code class="docutils literal notranslate"><span class="pre">null</span></code> als resultaat.
In NodeRed betekent dit: stuur  geen bericht naar de volgende nodes.</p></li>
<li><p>in het andere geval: geef <code class="docutils literal notranslate"><span class="pre">msg</span></code> als resultaat, m.a.w., geef het ontvangen bericht door aan de volgende nodes.</p></li>
</ul>
<p>Vraag: wat gebeurt er als we deze functie voor de tweede delay plaatsen?</p>
<ul class="simple">
<li><p>je kunt in het debug-venster aangeven dat je alleen de “current flow” wilt zien;</p></li>
<li><p>je kunt het debug-venster leeg maken via het vuilnisbakje (rechts boven).</p></li>
</ul>
<p class="rubric">Opdracht 3.2</p>
<p>De volgende stap is om elke deze waarden te koppelen aan de led van de IoT-knoop.
Eerst maken we de waarden geschikt voor de LED.
Vervolgens koppelen we deze aan de IoT-knoop, via MQTT.</p>
<ol class="arabic simple">
<li><p>Configureer de bovenste inject-node:</p>
<ol class="arabic simple">
<li><p>Stel de payload in als  JSON, met als waarde: <code class="docutils literal notranslate"><span class="pre">{&quot;0&quot;:</span> <span class="pre">{&quot;dOut&quot;:</span> <span class="pre">1}}</span></code>.
<em>Tip</em>: bij het invoeren van een JSON-waarde kun je de JSON-editor gebruiken,
via de <code class="docutils literal notranslate"><span class="pre">...</span></code> rechts in het edit-venster.
Je maakt dan minder fouten.</p></li>
<li><p>Bewaar de configuratie (“Save”)</p></li>
<li><p>“Deploy”, en controleer de output in het debug-venster.</p></li>
</ol>
</li>
<li><p>Configureer de onderste inject-node:</p>
<ol class="arabic simple">
<li><p>Stel de payload in als  JSON, met als waarde: <code class="docutils literal notranslate"><span class="pre">{&quot;0&quot;:</span> <span class="pre">{&quot;dOut&quot;:</span> <span class="pre">0}}</span></code>.</p></li>
<li><p>Bewaar de configuratie (“Save”)</p></li>
<li><p>“Deploy”, en controleer de output in het debug-venster.</p></li>
</ol>
</li>
<li><p>Voeg een MQTT output-node toe, en configureer deze:</p>
<ol class="arabic simple">
<li><p>stel de MQTT broker (“server”) in als in bij het dashboard.</p></li>
<li><p>gebruik als Topic: <code class="docutils literal notranslate"><span class="pre">node/xxxx/actuators</span></code>,
waarbij je voor <code class="docutils literal notranslate"><span class="pre">xxxx</span></code> de ID van je IoT-knoop invult.</p></li>
<li><p>Bewaar de configuratie (“Save”)</p></li>
<li><p>“Deploy”, en controleer de output in het debug-venster.</p></li>
</ol>
</li>
</ol>
<p>Als het goed is zie je nu de berichten niet alleen in het debug-venster verschijnen,
maar knippert de LED van je IoT-knoop ook op dezelfde manier mee.</p>
<blockquote>
<div><p>De codes voor het in- en uitschakelen van de LED behandelen we later uitgebreider.
De eerste <cite>“0”`</cite> staat hier voor LED-0.
Sommige IoT-knopen hebben ook een LED-1: probeer die op dezelfde manier te laten knipperen.</p>
</div></blockquote>
<p>Deze manier van werken is typisch voor NodeRed: je bouwt een flow beetje voor beetje op,
waarbij je in het begin veel gebruik maakt van inject- en debug-nodes.
Je test hiermee elke stap.
Deze nodes kun je laten zitten tijdens het gebruik:
een debug-node kun je eenvoudig uitschakelen als je deze even niet nodig hebt.</p>
<p>Nog enkele suggesties:</p>
<ul class="simple">
<li><p>je kunt meerdere MQTT-output-nodes toevoegen met dezelfde input,
voor verschillende IoT-knopen: je kunt die LEDs tegelijk laten knipperen.</p></li>
<li></li>
</ul>
</div>
<div class="section" id="koppelen-van-iot-apparaten">
<h2>4. Koppelen van IoT-apparaten<a class="headerlink" href="#koppelen-van-iot-apparaten" title="Permalink naar deze titel">¶</a></h2>
<p>In deze opdracht koppel je de knoppen van de ene IoT-knoop aan de LED van een andere IoT-knoop.
Je kunt deze LED dan op afstand aan- en uitzetten.</p>
<p>We moeten hiervoor de berichten die deze knoppen sturen splitsen in drie stromen:
voor het indrukken van de eerste button, voor het indrukken van de tweede button,
en voor het indrukken van beide buttons.</p>
<div class="figure align-center" id="id11">
<a class="reference internal image-reference" href="../_images/nodered-convert-buttons-function.png"><img alt="../_images/nodered-convert-buttons-function.png" src="../_images/nodered-convert-buttons-function.png" style="width: 200px;" /></a>
<p class="caption"><span class="caption-text">Function node <em>Convert-LPP-buttons</em></span><a class="headerlink" href="#id11" title="Permallink naar deze afbeelding">¶</a></p>
</div>
<p>Je kunt deze function-node op twee manieren aanmaken:</p>
<p><strong>Methode 1.</strong> Sleep een function-node naar het flow-gedeelte, en configureer deze als volgt:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><em>Name:</em>: <code class="docutils literal notranslate"><span class="pre">Convert-LPP-buttons</span></code></p></li>
<li><p><em>Function:</em> kopieer en plak onderstaande code</p></li>
<li><p><em>Outputs:</em> 3 (berichten voor het indrukken button 0 gaan naar output 0;
voor button 1 naar output 1; als beide buttons ingedrukt zijn: output 2)</p></li>
</ol>
</div></blockquote>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">button0</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">payload</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">dIn</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">button1</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">payload</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">dIn</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">button0</span> <span class="o">&amp;&amp;</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">button1</span><span class="p">){</span>
    <span class="k">return</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">msg</span><span class="p">];</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">button0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">msg</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">];</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">payload</span><span class="p">.</span><span class="nx">button1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="kc">null</span><span class="p">];</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p><strong>Methode 2</strong>.</p>
<ol class="arabic simple">
<li><p>Selecteer en kopieer de flow-tekst in JSON-notatie hieronder naar het Clipboard (CMD-C, CTRL-C afhankelijk van je O.S.)</p></li>
<li><p>Importeer deze in de flow:</p></li>
</ol>
<blockquote>
<div><ol class="lowerroman simple">
<li><p>Selecteer hamburgermenu -&gt; Import -&gt; Clipboard</p></li>
<li><p>“Paste” het clipboard in het venster (CMD-V, CTRL-V)</p></li>
<li><p>Klik “Import”</p></li>
</ol>
</div></blockquote>
<p>De function-node verschijnt nu in het flow-gedeelte.</p>
<p>JSON-tekst voor de flow:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="s2">&quot;c131fbb8.330988&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span><span class="nt">&quot;z&quot;</span><span class="p">:</span><span class="s2">&quot;8d3e9168.dadf98&quot;</span><span class="p">,</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;convert-LPP-buttons&quot;</span><span class="p">,</span><span class="nt">&quot;func&quot;</span><span class="p">:</span><span class="s2">&quot;if (msg.payload.payload.hasOwnProperty(\&quot;2\&quot;)) {\n  msg.payload.button0 = msg.payload.payload[2].dIn;\n}\nif (msg.payload.payload.hasOwnProperty(\&quot;3\&quot;)) {\n  msg.payload.button1 = msg.payload.payload[3].dIn;\n}\n\nif (msg.payload.button0 &amp;&amp; msg.payload.button1){\n    return [null, null, msg];\n} else if (msg.payload.button0) {\n    return [msg, null, null];\n} else if (msg.payload.button1) {\n    return [null, msg, null];\n} else {\n    return [null, null, null];\n}&quot;</span><span class="p">,</span><span class="nt">&quot;outputs&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="nt">&quot;noerr&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nt">&quot;x&quot;</span><span class="p">:</span><span class="mi">580</span><span class="p">,</span><span class="nt">&quot;y&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="nt">&quot;wires&quot;</span><span class="p">:[[</span><span class="s2">&quot;eff69e91.a729b8&quot;</span><span class="p">],[</span><span class="s2">&quot;ddca2d4b.b32878&quot;</span><span class="p">],[]]}]</span>
</pre></div>
</div>
<div class="section" id="opdracht-4-1-besturen-van-je-eigen-iot-knoop">
<h3>Opdracht 4.1 Besturen van je eigen IoT-knoop<a class="headerlink" href="#opdracht-4-1-besturen-van-je-eigen-iot-knoop" title="Permalink naar deze titel">¶</a></h3>
<ol class="arabic simple">
<li><p>Maak de function-node zoals hierboven beschreven</p></li>
<li><p>Maak met deze function node de onderstaande flow.
Zorg ervoor dat de MQTT-nodes voor je eigen button geconfigureerd zijn.</p></li>
<li><p>Activeer deze flow (Deploy).</p></li>
</ol>
<div class="figure align-center">
<a class="reference internal image-reference" href="../_images/nodered-buttons-led-flow-0.png"><img alt="../_images/nodered-buttons-led-flow-0.png" src="../_images/nodered-buttons-led-flow-0.png" style="width: 600px;" /></a>
</div>
<p>Nu kun je met de buttons op je IoT-knoop de LED aan- en uitzetten.</p>
<p>Merk op dat in deze flow een JSON-node gebruikt wordt.
Hiermee zet je de string-notatie zoals als MQTT-bericht binnenkomt om in een JavaScript-object
dat je gemakkelijk in functies e.d. kunt gebruiken.</p>
<p><em>Hint</em> Vergelijk met behulp van de debug-node het formaat van de MQTT-berichten zoals deze binnenkomen
en nadat deze via de JSON-node omgezet zijn.</p>
</div>
<div class="section" id="opdracht-4-2-besturen-van-een-andere-iot-knoop">
<h3>Opdracht 4.2 Besturen van een andere IoT-knoop<a class="headerlink" href="#opdracht-4-2-besturen-van-een-andere-iot-knoop" title="Permalink naar deze titel">¶</a></h3>
<ol class="arabic simple">
<li><p>Pas het Topic van de mqtt-output-node aan voor de knoop die je wilt besturen.</p></li>
<li><p>Activeer de flow.</p></li>
</ol>
<p>Nu besturen de buttons van je IoT-knoop de LED van een andere knoop.</p>
<p>Variaties:</p>
<ol class="loweralpha simple">
<li><p>je kunt op deze manier ook meerdere IoT-knopen besturen:
met de output van een template-node kun je meerdere mqtt-output-nodes aansturen.</p></li>
<li></li>
</ol>
<p>Vraag: we gebruiken twee verschillende buttons: één voor het aanzetten,
en één voor het uitzetten van de LED. Waarom doen we dit?</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<jinja2.runtime.BlockReference object at 0x108660d10>
<script type="text/javascript">
  $(document).trigger("runestone:login-complete");
</script>

  </body>
</html>