
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="nl">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>MQTT: publish-subscribe &#8212; iot-1  documentatie</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Zoeken" href="../search.html" />
    <link rel="next" title="Opdrachten" href="opdrachten.html" />
    <link rel="prev" title="MQTT en JSON" href="../mqtt.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">iot-1</a></h1>








<h3>Navigatie</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../ten-geleide.html">Ten geleide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../inleiding.html">Inleiding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bouwstenen.html">Bouwstenen</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../mqtt.html">MQTT en JSON</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">MQTT: publish-subscribe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mqtt-in-het-iot">MQTT in het IoT</a></li>
<li class="toctree-l2"><a class="reference internal" href="#structuur-van-een-topic">Structuur van een topic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#json">JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="#links">Links</a></li>
<li class="toctree-l2"><a class="reference internal" href="opdrachten.html">Opdrachten</a></li>
<li class="toctree-l2"><a class="reference internal" href="toetsvragen.html">Toetsvragen</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nodered.html">NodeRed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../webserver.html">Webserver-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wifi.html">WiFi-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rfm69.html">RFM69-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lora.html">LoRa-knopen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../todo.html">ToDo</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../mqtt.html">MQTT en JSON</a><ul>
      <li>Previous: <a href="../mqtt.html" title="vorig hoofdstuk">MQTT en JSON</a></li>
      <li>Next: <a href="opdrachten.html" title="volgend hoofdstuk">Opdrachten</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Snel zoeken</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Zoek" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mqtt-publish-subscribe">
<h1>MQTT: publish-subscribe<a class="headerlink" href="#mqtt-publish-subscribe" title="Permalink naar deze titel">¶</a></h1>
<p>MQTT is een zogenaamd publish-subscribe protocol.
De communicatie vindt plaats tussen clients, met tussenkomst van een broker (makelaar).
De broker heeft alleen als taak om berichten door te sturen:</p>
<ul class="simple">
<li>een client kan zich bij de broker abonneren (<em>subscribe</em>) op de berichten van een bepaald onderwerp (<em>topic</em>);</li>
<li>een client kan een bericht van een bepaald onderwerp publiceren (<em>publish</em>).
De broker stuurt dit bericht dan door naar alle clients zich op dit onderwerp geabonneerd hebben.</li>
<li>een client kan zowel <em>publisher</em> als <em>subscriber</em> zijn.</li>
</ul>
<p>Dit laatste betekent dat de broker op een willekeurig moment een bericht naar een client kan <em>pushen</em>:
deze client hoeft niet steeds bij de broker te vragen of er een nieuw bericht aangekomen is.</p>
<blockquote>
<div><p><em>Dit is een verschil met het HTTP-protocol: in dat geval ligt het initiatief altijd bij de client,
deze “trekt” (*pull</em>) de documenten van de server.*</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="../_images/MQTT1.png"><img alt="../_images/MQTT1.png" src="../_images/MQTT1.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">MQTT voorbeeld</span></p>
</div>
</div></blockquote>
<p>In de figuur publiceert client A bericht M met topic T.
De broker stuurt dit bericht door (<em>push</em>) naar clients B en D,
die zich eerder met “subscribe(T)” op topic T geabonneerd hebben.
Client C heeft zich niet geabonneerd op topic T, en ontvangt bericht M dus niet.</p>
<p>Op een volgend moment kan client B een bericht publiceren met een topic waar bijvoorbeeld A, C en D op geabonneerd zijn.
Client B is dan zowel <em>publisher</em> als <em>subscriber</em>.</p>
<p>Deze publish/subscribe-aanpak heeft de volgende eigenschappen:</p>
<ul class="simple">
<li><em>push</em> van berichten van de client naar de broker, en van de broker naar de clients.</li>
<li><em>losse koppeling</em> tussen de clients:
de clients communiceren via een topic, en weten niet welke clients aan dat topic gekoppeld zijn.
In het bijzonder weet een publisher niet welke clients op het topic geabonneerd zijn.</li>
</ul>
</div>
<div class="section" id="mqtt-in-het-iot">
<h1>MQTT in het IoT<a class="headerlink" href="#mqtt-in-het-iot" title="Permalink naar deze titel">¶</a></h1>
<p>In de context van het Internet of Things zijn zowel IoT-knopen als IoT-apps clients van de MQTT-broker.</p>
<p>Een typisch gebruik van MQTT voor IoT-toepassingen:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>een IoT-knoop publiceert zijn sensordata naar de broker</dt>
<dd><ul class="first last">
<li>als de sensordata veranderd zijn, of met een vaste regelmaat;</li>
<li>met een topic dat gekoppeld is aan de identiteit van de IoT-knoop;</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>een IoT-knoop abonneert zich op de actuatordata voor de eigen actuatoren</dt>
<dd><ul class="first last">
<li>met een topic dat gekoppeld is aan de identiteit van de knoop;</li>
</ul>
</dd>
</dl>
</li>
<li>een IoT-app abonneert zich op de sensordata van de relevante knopen;</li>
<li><dl class="first docutils">
<dt>een IoT-app stuurt een actuator in een IoT-knoop aan door een “publish”</dt>
<dd><ul class="first last">
<li>van een bericht met het actuator-topic van de IoT-knoop.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p class="rubric">Voorbeeld</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="../_images/MQTT-IoT.png"><img alt="../_images/MQTT-IoT.png" src="../_images/MQTT-IoT.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">MQTT in het Internet of Things</span></p>
</div>
<p>Uitleg:</p>
<ul class="simple">
<li>IoT-knoop A publiceert zijn sensordata onder topic <code class="docutils literal notranslate"><span class="pre">A/sensors</span></code></li>
<li>IoT-knoop A (na “subscribe(A/led)”) ontvangt de berichten voor het aansturen van de eigen LED</li>
<li>analoog voor IoT-knoop B</li>
<li><dl class="first docutils">
<dt>toepassing (app) C ontvangt (na “subscribe(+/sensors)”) de sensordata van A en van B</dt>
<dd><ul class="first last">
<li>“+” is hierin een wildcard-teken: dit past op alle strings (node-id’s)</li>
</ul>
</dd>
</dl>
</li>
<li>toepassing C stuurt de LED van de node A aan.</li>
<li><dl class="first docutils">
<dt>analoog voor app D</dt>
<dd><ul class="first last">
<li>deze communiceert alleen met node B.</li>
</ul>
</dd>
</dl>
</li>
<li>de broker stuurt de sensordata door naar de apps, en de led-aansturing naar de IoT-knopen.</li>
</ul>
</div>
<div class="section" id="structuur-van-een-topic">
<h1>Structuur van een topic<a class="headerlink" href="#structuur-van-een-topic" title="Permalink naar deze titel">¶</a></h1>
<p>Een MQTT-topic bestaat uit een aantal strings gekoppeld door <code class="docutils literal notranslate"><span class="pre">/</span></code>,
bijvoorbeeld <code class="docutils literal notranslate"><span class="pre">abd</span></code>, <code class="docutils literal notranslate"><span class="pre">abc/def</span></code>, <code class="docutils literal notranslate"><span class="pre">abc/123/def</span></code>.
Dit lijkt op de padnaam in een URL.</p>
<p>Bij een <em>subscribe</em> kun je in de topic-string ook wildcards opnemen:
<code class="docutils literal notranslate"><span class="pre">+</span></code> staat voor een willekeurige string zonder <code class="docutils literal notranslate"><span class="pre">/</span></code>;
<code class="docutils literal notranslate"><span class="pre">#</span></code> voor een willekeurige string waarin ook het koppelteken <code class="docutils literal notranslate"><span class="pre">/</span></code> mag voorkomen.
* voorbeeld: <code class="docutils literal notranslate"><span class="pre">node/+/sensors</span></code> matcht met <code class="docutils literal notranslate"><span class="pre">node/12/sensors</span></code> en <code class="docutils literal notranslate"><span class="pre">node/432/sensors</span></code>.
* voorbeeld: <code class="docutils literal notranslate"><span class="pre">node/#</span></code> matcht met <code class="docutils literal notranslate"><span class="pre">node/12/sensors</span></code> en <code class="docutils literal notranslate"><span class="pre">node/432/led</span></code></p>
</div>
<div class="section" id="json">
<h1>JSON<a class="headerlink" href="#json" title="Permalink naar deze titel">¶</a></h1>
<div class="sidebar">
<p class="first sidebar-title">JSON in het web</p>
<p class="last">Ook het web gebruikt het JSON-formaat, als onderdeel van AJAX.
JavaScript-functies in een app communiceren vanuit de browser met de server,
met (naar verhouding) kleine hoeveelheden data.
Deze communicatie gebruikt het compacte en leesbare JSON-formaat, in plaats van complete HTML-documenten.</p>
</div>
<p>In dit hoofdstuk gebruiken we MQTT voor het bewaken en besturen van een IoT-knoop.
De communicatie tussen de IoT-knoop en de toepassing (app), via de MQTT-broker,
vindt plaats in de vorm van JSON-berichten.
Het JSON-formaat is voor het IoT wat HTML is voor het web.
We leggen hieronder eerst de principes van JSON uit.
In de opdracht gebruik je JSON voor het aansturen van de IoT-knoop.</p>
<p>JSON staat voor “JavaScript Object Notatie”.
Een JSON-document is een tekstdocument: een leesbare vorm van een JavaScript-object.
Een object bestaat uit een aantal &lt;code&gt;”naam”: waarde&lt;/code&gt;-paren.
Een waarde kan een enkelvoudige waarde zijn, bijvoorbeeld een getal, een string, of een boolean.
Het kan ook een samengestelde waarde zijn: een object of een array.
In JavaScript gebruiken we de notatie: <code class="docutils literal notranslate"><span class="pre">naam:</span> <span class="pre">waarde</span></code>.
In JSON staat de naam tussen dubbele quotes: <code class="docutils literal notranslate"><span class="pre">&quot;naam&quot;:</span> <span class="pre">waarde</span></code>.</p>
<p>We geven in de onderstaande voorbeelden de JavaScript-objecten en de bijbehorende JSON-notatie.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nx">temp</span><span class="o">:</span> <span class="mi">21</span><span class="p">,</span> <span class="nx">press</span><span class="o">:</span> <span class="mi">1015</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="s2">&quot;e4c7&quot;</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;temp&quot;</span><span class="p">:</span><span class="mi">123</span><span class="p">,</span><span class="nt">&quot;press&quot;</span><span class="p">:</span><span class="mi">1012</span><span class="p">,</span> <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;e4c7&quot;</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Te doen</p>
<ul class="last simple">
<li>meer JSON-voorbeelden</li>
</ul>
</div>
<p>Je kunt een JSON-document eenvoudig omzetten in een JavaScript-object, en omgekeerd:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">obj</span> <span class="pre">=</span> <span class="pre">JSON.parse(str);</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">str</span> <span class="pre">=</span> <span class="pre">JSON.stringify(obj);</span></code></li>
</ul>
<p>Niet alle JavaScript-objecten kun je in JSON omzetten:</p>
<ul class="simple">
<li>objecten met functie-waarden</li>
<li>objecten met onderlinge verwijzingen die een lus (cykel) vormen.</li>
</ul>
<p>Veel programmeertalen hebben functies om JSON-objecten te verwerken.</p>
<ul class="simple">
<li>Python: <a class="reference external" href="https://docs.python.org/3/library/json.html">https://docs.python.org/3/library/json.html</a></li>
<li>Arduino: <a class="reference external" href="https://arduinojson.org/">https://arduinojson.org/</a></li>
</ul>
</div>
<div class="section" id="links">
<h1>Links<a class="headerlink" href="#links" title="Permalink naar deze titel">¶</a></h1>
<ul class="simple">
<li>referentie: <a class="reference external" href="https://www.json.org/">https://www.json.org/</a></li>
<li>referentie: <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON</a></li>
<li>tutorial: <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON">https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON</a></li>
</ul>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2018, SLO.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/mqtt/mqtt-pubsub.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>